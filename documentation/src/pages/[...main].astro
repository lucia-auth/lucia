---
import ContentTable from "@components/doc/content-table";
import DocumentLayout from "@layouts/DocumentLayout.astro";

import type { GetStaticPaths } from "astro";
import { db } from "@lib/db";
import type { GetPropsFromGetStaticPaths } from "@lib/astro";

export const getStaticPaths = (async () => {
	const mainCollection = await db.collection("main").get();
	const documents = mainCollection._getAllDocuments();
	return documents.map((doc) => {
		const pathSegements = doc._path.split("/"); // ["integration", "astro", "start-here", "getting-started"]
		return {
			params: {
				main: pathSegements.slice(1).join("/")
			},
			props: {
				page: pathSegements[1],
				doc,
				collections: mainCollection._collections
			}
		};
	});
}) satisfies GetStaticPaths;

type Props = GetPropsFromGetStaticPaths<typeof getStaticPaths>;

const { doc, collections, page } = Astro.props;
---

<DocumentLayout doc={doc}>
	<ContentTable
		client:load
		collections={collections}
		currentPath={Astro.url.pathname}
		initialCollectionId={page}
		slot="table"
	/>
	<doc._Content slot="content" />
</DocumentLayout>
